import{r as l,s as g,a as s,F as f,j as t,L as B,B as P,P as _,A as U,H}from"./index-tnQiTXzG.js";function T({theme:k,toggleTheme:x}){T.propTypes={theme:String,toggleTheme:Function};const[h,C]=l.useState(!1),[n,S]=l.useState(null),[I,E]=l.useState(!1),[L,c]=l.useState(null),[R,w]=l.useState(!1),[y,D]=l.useState(!1);l.useEffect(()=>{const i=window.location.href.split("register")[1].replace("#","").split("&").reduce((r,d)=>{const[u,o]=d.split("=");return{...r,[u]:o}},{});i.type==="invite"&&(async()=>{var u;const{data:{session:r},error:d}=await g.auth.setSession({access_token:i.access_token,refresh_token:i.refresh_token});if(!d)if(E(!!(r!=null&&r.user)),S((r==null?void 0:r.user)??null),r!=null&&r.user){const{data:o}=await g.from("profiles").select("has_registered").eq("id",(u=r==null?void 0:r.user)==null?void 0:u.id).limit(1).single();D((o==null?void 0:o.has_registered)??!1),o!=null&&o.has_registered?document.title="Access Denied | shortUrl by setul":document.title="Register | shortUrl by setul"}else document.title="Access Denied | shortUrl by setul";h||C(!0)})()},[]),l.useEffect(()=>{if(h){const e=document.querySelector(".website-loader-container");e&&(e.style.opacity="0",setTimeout(()=>{e.remove()},400))}},[h]);async function N(e){e.preventDefault();function a(p){const b=document.getElementById("register-button"),A=document.getElementById("register-cancel-button");b.classList.toggle("button--loading"),b.disabled=p,A.disabled=p,e.target.elements["register-handle-input"].disabled=p,e.target.elements["register-password-input"].disabled=p,e.target.elements["register-re-password-input"].disabled=p}a(!0);const i=e.target.elements["register-handle-input"].value,r=e.target.elements["register-password-input"].value,d=e.target.elements["register-re-password-input"].value;if(r!==d){a(!1),m(e.target.elements["register-re-password-input"]),e.target.elements["register-re-password-input"].classList.add("invalid"),e.target.elements["register-re-password-input"].focus();return}if(!n){c(t("p",{id:"register-error-text",children:"You must be authenticated"})),a(!1);return}const{data:u,error:o}=await g.auth.updateUser({password:r});if(console.log("Update password data:",u,"Update password error:",o),o){c(t("p",{id:"register-error-text",children:"That's on us, something went wrong. Try again later."})),a(!1);return}const{data:q,error:v}=await g.from("profiles").update({handle:i,has_registered:!0}).eq("id",n.id);if(console.log(q,v),v){c(t("p",{id:"register-error-text",children:"Hmm, looks like this handle's taken"})),a(!1),e.target.elements["register-handle-input"].classList.add("invalid"),e.target.elements["register-handle-input"].focus();return}window.location.href="/"}function m(e){const a=e.id,i=e.validity;if(i.customError&&(e.setCustomValidity(""),e.checkValidity()),i.valueMissing)switch(e.classList.remove("invalid"),a){case"register-handle-input":e.setCustomValidity("A handle is required.");break;case"register-password-input":e.setCustomValidity("A password is required."),c(null);break;case"register-re-password-input":e.setCustomValidity("Please confirm your password.");break}else if(i.tooShort||i.tooLong)switch(e.classList.add("invalid"),a){case"register-handle-input":e.setCustomValidity("Handle must be 4 to 30 characters long.");break;case"register-password-input":case"register-re-password-input":e.setCustomValidity("Password must be at least 8 characters long.");break}else if(e.checkValidity())switch(e.classList.remove("invalid"),a){case"register-password-input":e.value===document.getElementById("register-re-password-input").value&&document.getElementById("register-re-password-input").classList.remove("invalid"),c(null);break;case"register-re-password-input":e.value!==document.getElementById("register-password-input").value&&(e.setCustomValidity("Passwords must match."),e.checkValidity(),e.classList.add("invalid"));break}else switch(e.classList.add("invalid"),a){case"register-handle-input":e.setCustomValidity("Handle can only contain letters and numbers.");break;case"register-password-input":e.setCustomValidity("Password must match requirements."),c(s("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"start",paddingLeft:"0.8em"},children:[t("p",{style:{color:"var(--text-color)",textAlign:"left",fontSize:"0.75rem",margin:"0",transition:"color var(--slow-transition-duration) var(--primary-curve)"},children:"Password requirements:"}),s("ul",{id:"register-error-text",style:{textAlign:"left",fontSize:"0.75rem",margin:"0 0 1em 0",listStyle:"none",padding:"0"},children:[t("li",{className:/^[\S]{8,}$/.test(e.value)?"password-check-green":"password-check-red",style:{transition:"color var(--quick-transition-duration) var(--primary-curve)"},children:"8+ characters long"}),t("li",{className:/(?=.*[A-Z])/.test(e.value)?"password-check-green":"password-check-red",style:{transition:"color var(--quick-transition-duration) var(--primary-curve)"},children:"Has an uppercase letter"}),t("li",{className:/(?=.*[a-z])/.test(e.value)?"password-check-green":"password-check-red",style:{transition:"color var(--quick-transition-duration) var(--primary-curve)"},children:"Has a lowercase letter"}),t("li",{className:/(?=.*\d)/.test(e.value)?"password-check-green":"password-check-red",style:{transition:"color var(--quick-transition-duration) var(--primary-curve)"},children:"Has a number"}),t("li",{className:/(?=.*[^\w\d])/.test(e.value)?"password-check-green":"password-check-red",style:{transition:"color var(--quick-transition-duration) var(--primary-curve)"},children:"Has a special character"})]})]}));return}e.reportValidity()}async function V(e){e&&function(i){const r=document.getElementById("register-cancel-button"),d=document.getElementById("register-button");r.classList.toggle("button--loading"),r.disabled=i,d.disabled=i,document.getElementById("register-handle-input").disabled=i,document.getElementById("register-password-input").disabled=i,document.getElementById("register-re-password-input").disabled=i}(!0),setTimeout(()=>{w(!1)},401)}return s(f,{children:[t("div",{className:"website-loader-container",children:t(B,{})}),t(P,{}),t(_,{}),R&&t(U,{onClose:V,title:"Delete Invitation",text:"Are you sure you want to permanently delete this invitation? This action cannot be undone. You will need another invite to create an account."}),t(H,{theme:k,toggleTheme:x,title:"shortUrl"}),t("div",{className:"container",children:t("div",{className:"primary-card-blurred",style:{maxWidth:"500px",height:"fit-content",borderRadius:"2em",padding:"2em",transition:"background-color var(--slow-transition-duration) var(--primary-curve), color var(--slow-transition-duration) var(--primary-curve), border-color var(--slow-transition-duration) var(--primary-curve)"},children:I&&!y?s(f,{children:[t("h1",{children:"Hey there! ðŸ«¡"}),t("p",{}),s("form",{id:"register-form",onSubmit:N,className:"register-form",children:[t("p",{style:{margin:"0"},children:"We need just a few more details to finish setting up your account and you're in!"}),t("p",{style:{margin:"0",color:"var(--text-color-disabled)"},children:"ðŸ›ˆ This page is time sensitive"}),s("div",{id:"register-handle-input-container",style:{width:"100%",display:"flex",alignItems:"center"},children:[t("label",{htmlFor:"register-handle-input",children:"@"}),t("input",{type:"text",name:"register-handle-input",id:"register-handle-input",onInput:e=>{typeof e.target.reportValidity=="function"&&m(e.target)},placeholder:"handle",pattern:"^[a-zA-Z0-9]*$",maxLength:30,minLength:4,form:"register-form",title:"Enter your handle",required:!0})]}),t("input",{type:"email",name:"register-email-input",id:"register-email-input",style:{borderRadius:"1em"},placeholder:"email",value:n==null?void 0:n.email,form:"register-form",title:"Enter your email address",required:!0,disabled:!0}),t("input",{type:"password",name:"register-password-input",id:"register-password-input",onInput:e=>{typeof e.target.reportValidity=="function"&&m(e.target)},pattern:"^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[^\\w\\d])[\\S]{8,}$",style:{borderRadius:"1em"},placeholder:"password",form:"register-form",title:"Enter your password",required:!0}),t("input",{type:"password",name:"register-re-password-input",id:"register-re-password-input",onInput:e=>{typeof e.target.reportValidity=="function"&&m(e.target)},style:{borderRadius:"1em"},placeholder:"re-enter password",form:"register-form",title:"Re-enter your password",required:!0}),L,s("div",{style:{display:"flex",justifyContent:"space-between"},children:[t("button",{type:"button",id:"register-cancel-button",form:"register-form",className:"default-button red-button",value:"cancel",title:"Cancel and delete account",onClick:()=>{w(!0)},style:{position:"relative"},children:t("span",{className:"button__text",children:"Cancel"})}),t("button",{type:"submit",id:"register-button",form:"register-form",className:"default-button primary-button",value:"register",title:"Register",style:{position:"relative"},children:t("span",{className:"button__text",children:"Register"})})]})]})]}):s(f,{children:[t("h1",{style:{color:"#d12e2e",marginBottom:"0.25em"},children:"Access Denied ðŸš«"}),s("p",{children:["No wristband, no entry. ",y?"You have already registered. We can't let you register again.":"You're not authenticated via an invite. We can't let you register.","  Sorry!"]}),s("div",{style:{display:"flex",margin:"1.5em 0"},children:[t("div",{style:{display:"flex",flexDirection:"column",width:"50%",justifyContent:"center",alignItems:"center"},children:s("div",{style:{display:"flex",flexDirection:"column",gap:"0.8em",textAlign:"left"},children:[t("span",{children:"Status:"}),t("span",{children:"Associated email:"}),t("span",{children:"Details:"})]})}),s("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",width:"50%",alignItems:"center",gap:"0.25em"},children:[t("span",{style:{color:"#d12e2e",fontWeight:"bold",backgroundColor:"var(--primary-color)",padding:"0.25em 1em",borderRadius:"1em",width:"fit-content"},children:(n==null?void 0:n.aud)??"unknown"}),t("span",{style:{color:"#2e6fd1",fontWeight:"bold",backgroundColor:"var(--primary-color)",padding:"0.25em 1em",borderRadius:"1em",width:"fit-content"},children:(n==null?void 0:n.email)??"null"}),t("span",{style:{color:"var(--text-color-disabled)",fontWeight:"bold",backgroundColor:"var(--primary-color)",padding:"0.25em 1em",borderRadius:"1em",width:"fit-content"},children:y?"Already registered":"Not on guest list"})]})]}),t("button",{type:"button",id:"go-home-button",className:"default-button primary-button",value:"home",title:"Go home",onClick:()=>{window.location.href="/"},children:"Go home"})]})})}),s("footer",{style:{fontFamily:"Kaushan Script",transition:"color var(--quick-transition-duration) var(--primary-curve)"},children:["Copyright Â© 2025 Setul Parekh.All rights reserved. | ",t("button",{className:"link",onClick:()=>window.privacyPolicyDialog.showModal(),children:"Privacy Policy ðŸ™Š"})," | ",t("button",{className:"link",onClick:()=>window.open("https://www.setulp.com","_blank"),children:"My Portfolio ðŸ“‚"})]})]})}export{T as default};
